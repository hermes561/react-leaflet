(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{120:function(e,t,a){e.exports=a.p+"static/media/chat_location_current.7267d3fc.svg"},121:function(e,t,a){e.exports=a.p+"static/media/chat_location.0cb38dea.svg"},127:function(e,t,a){e.exports=a(259)},132:function(e,t,a){},148:function(e,t){},150:function(e,t){},184:function(e,t){},185:function(e,t){},259:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),o=a(48),r=a.n(o),i=(a(132),a(7)),c=a(117),l=a(118),m=a(49),u=a(125),g=a(119),h=a(126),d=a(2),p=a(262),f=a(272),v=a(273),M=a(274),E=(a(133),a(134),a(15)),w=a.n(E),b=a(263),y=a(264),S=a(265),j=a(266),O=a(267),z=a(268),U=a(269),k=a(270),x=a(271),_=a(33),C=a.n(_),A=a(120),N=a.n(A),L=a(121),R=a.n(L),T=a(42),I=a.n(T),J=w.a.icon({iconUrl:R.a,iconSize:[50,82],iconAnchor:[0,82],popupAnchor:[25,-65],shadowUrl:I.a,shadowRetinaUrl:I.a,shadowSize:[50,82],shadowAnchor:[0,93]}),V=w.a.icon({iconUrl:N.a,iconSize:[50,82],iconAnchor:[0,82],popupAnchor:[25,-65],shadowUrl:I.a,shadowRetinaUrl:I.a,shadowSize:[50,82],shadowAnchor:[0,93]}),W=C.a.object().keys({name:C.a.string().regex(/^[a-zA-Z0-9\xc0-\u017e -_]{1,100}$/).required(),message:C.a.string().min(1).max(500).required()}),q="localhost"===window.location.hostname?"http://localhost:5000/api/v1/messages":"production_url_here",B=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={haveUserLocation:!1,location:{lat:44.439,lng:26.096},zoom:2,userMeassage:{name:"",message:""},sendingMessage:!1,sentMessage:!1,messages:[],error:null},a.mapRef=s.a.createRef(),a.formIsValid=function(){var e={name:a.state.userMeassage.name,message:a.state.userMeassage.message};return null===C.a.validate(e,W).error&&a.state.haveUserLocation},a.handleSubmit=function(e){e.preventDefault(),a.formIsValid()&&(a.setState({sendingMessage:!0}),fetch(q,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:a.state.userMeassage.name,message:a.state.userMeassage.message,latitude:a.state.location.lat,longitude:a.state.location.lng})}).then(function(e){return e.json()}).then(function(e){var t=Object(d.a)(Object(d.a)(a));setTimeout(function(){t.setState({sendingMessage:!1,sentMessage:!0}),t.getMesages()},1e3)}).catch(function(e){var t=Object(d.a)(Object(d.a)(a));setTimeout(function(){t.setState({error:"Canot add data to server!",sendingMessage:!1,sentMessage:!1})},1e3)}))},a.handleOnChange=function(e){a.setState({userMeassage:Object(c.a)({},a.state.userMeassage,Object(i.a)({},e.target.name,e.target.value))})},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"getMesages",value:function(){var e=this;fetch(q).then(function(e){return e.json()}).then(function(t){var a={};t=t.reduce(function(e,t){var n="".concat(t.latitude.toFixed(3)).concat(t.longitude.toFixed(3));return a[n]?(a[n].otherMessages=a[n].otherMessages||[],a[n].otherMessages.push(t)):(a[n]=t,e.push(t)),e},[]),e.setState({messages:t})}).catch(function(t){return e.setState({error:"Canot load data from server!"})})}},{key:"componentDidMount",value:function(){var e=this;this.getMesages(),navigator.geolocation.getCurrentPosition(function(t){console.log(t),t&&e.setState({location:{lat:t.coords.latitude,lng:t.coords.longitude},zoom:15,haveUserLocation:!0})},function(t){console.log("we don't have their location"),fetch("https://ipapi.co/json").then(function(e){return e.json()}).then(function(t){e.setState({location:{lat:t.latitude,lng:t.longitude},zoom:15,haveUserLocation:!0})})});var t=this.mapRef.current;null!==t&&setTimeout(function(){t.leafletElement.invalidateSize()},400)}},{key:"render",value:function(){var e=this.state.location,t=this.state.sentMessage?"":s.a.createElement(p.a,{position:[e.lat,e.lng],icon:J}),a=this.state.messages.length?this.state.messages.map(function(e){return s.a.createElement(p.a,{key:e._id,position:[e.latitude,e.longitude],icon:V},s.a.createElement(f.a,null,s.a.createElement("p",null,s.a.createElement("em",null,e.name),": ",e.message),e.otherMessages?e.otherMessages.map(function(e,t){return s.a.createElement("p",{key:"item"+t},s.a.createElement("em",null,e.name),": ",e.message)}):""))}):"",n=this.state.sendingMessage||this.state.sentMessage||!this.state.haveUserLocation?this.state.sendingMessage||!this.state.haveUserLocation?s.a.createElement("img",{className:"loadin_img",src:"loading.gif",alt:"loading..."}):s.a.createElement(z.a,null,"Thanks for submitting a message!"):s.a.createElement(b.a,{onSubmit:this.handleSubmit},s.a.createElement(y.a,null,s.a.createElement(S.a,{for:"name"},"Name"),s.a.createElement(j.a,{onChange:this.handleOnChange,type:"text",name:"name",id:"name",placeholder:"Enter your Name"})),s.a.createElement(y.a,null,s.a.createElement(S.a,{for:"message"},"Message"),s.a.createElement(j.a,{onChange:this.handleOnChange,type:"textarea",name:"message",id:"message",placeholder:"Enter your Message"})),s.a.createElement(O.a,{colour:"info",disabled:!this.formIsValid()},"Send"));return s.a.createElement("div",{className:"map"},s.a.createElement(v.a,{center:[e.lat,e.lng],zoom:this.state.zoom,ref:this.mapRef,className:"map"},s.a.createElement(M.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t,a),s.a.createElement(U.a,{className:"message-form"},s.a.createElement(k.a,null,s.a.createElement(x.a,null,"Welcome to GuestM.app!"),s.a.createElement(z.a,null,"Live a message with your location!"),this.state.error?s.a.createElement(z.a,{className:"warning"},this.state.error):"",n)))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},42:function(e,t,a){e.exports=a.p+"static/media/chat_location_shadow.cc966781.svg"}},[[127,1,2]]]);
//# sourceMappingURL=main.c879d1eb.chunk.js.map