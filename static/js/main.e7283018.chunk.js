(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{120:function(e,t,a){e.exports=a.p+"static/media/chat_location_current.7267d3fc.svg"},121:function(e,t,a){e.exports=a.p+"static/media/chat_location.0cb38dea.svg"},127:function(e,t,a){e.exports=a(259)},132:function(e,t,a){},148:function(e,t){},150:function(e,t){},184:function(e,t){},185:function(e,t){},259:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),o=a(48),r=a.n(o),i=(a(132),a(7)),c=a(117),l=a(118),m=a(49),u=a(125),h=a(119),g=a(126),d=a(2),f=a(271),p=a(272),v=a(273),M=a(274),E=(a(133),a(134),a(15)),w=a.n(E),b=a(33),S=a.n(b),y=a(120),O=a.n(y),j=a(121),C=a.n(j),U=a(42),k=a.n(U),x="localhost"===window.location.hostname?"http://localhost:5000/api/v1/messages":"https://thawing-beyond-39791.herokuapp.com/api/v1/messages";function z(){return fetch(x).then(function(e){return e.json()}).then(function(e){var t={};return e.reduce(function(e,a){var n="".concat(a.latitude.toFixed(3)).concat(a.longitude.toFixed(3));return t[n]?(t[n].otherMessages=t[n].otherMessages||[],t[n].otherMessages.push(a)):(t[n]=a,e.push(a)),e},[])})}var N=a(262),A=a(263),L=a(264),_=a(265),I=a(266),R=a(267),T=a(268),V=a(269),P=a(270),J=function(e){var t=e.sendingMessage||e.sentMessage||!e.haveUserLocation?e.sendingMessage||!e.haveUserLocation?s.a.createElement("img",{className:"loadin_img",src:"loading.gif",alt:"loading..."}):s.a.createElement(R.a,null,"Thanks for submitting a message!"):s.a.createElement(N.a,{onSubmit:e.handleSubmit},s.a.createElement(A.a,null,s.a.createElement(L.a,{for:"name"},"Name"),s.a.createElement(_.a,{onChange:e.handleOnChange,type:"text",name:"name",id:"name",placeholder:"Enter your Name"})),s.a.createElement(A.a,null,s.a.createElement(L.a,{for:"message"},"Message"),s.a.createElement(_.a,{onChange:e.handleOnChange,type:"textarea",name:"message",id:"message",placeholder:"Enter your Message"})),s.a.createElement(I.a,{colour:"info",disabled:e.formIsNotValid},"Send"));return s.a.createElement(T.a,{className:"message-form"},s.a.createElement(V.a,null,s.a.createElement(P.a,null,"Welcome to GuestM.app!"),s.a.createElement(R.a,null,"Live a message with your location!"),e.error?s.a.createElement(R.a,{className:"warning"},e.error):"",t))},W=w.a.icon({iconUrl:C.a,iconSize:[50,82],iconAnchor:[9,57],popupAnchor:[25,-65],shadowUrl:k.a,shadowRetinaUrl:k.a,shadowSize:[50,82],shadowAnchor:[9,57]}),q=w.a.icon({iconUrl:O.a,iconSize:[50,82],iconAnchor:[9,57],popupAnchor:[25,-65],shadowUrl:k.a,shadowRetinaUrl:k.a,shadowSize:[50,82],shadowAnchor:[9,57]}),B=S.a.object().keys({name:S.a.string().regex(/^[a-zA-Z0-9\xc0-\u017e -_]{1,100}$/).required(),message:S.a.string().min(1).max(500).required()}),D=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={haveUserLocation:!1,location:{lat:44.439,lng:26.096},zoom:3,userMeassage:{name:"",message:""},sendingMessage:!1,sentMessage:!1,messages:[],error:null},a.mapRef=s.a.createRef(),a.formIsValid=function(){var e={name:a.state.userMeassage.name,message:a.state.userMeassage.message};return null===S.a.validate(e,B).error&&a.state.haveUserLocation},a.handleSubmit=function(e){if(e.preventDefault(),a.formIsValid()){a.setState({sendingMessage:!0});var t={name:a.state.userMeassage.name,message:a.state.userMeassage.message,latitude:a.state.location.lat,longitude:a.state.location.lng},n=Object(d.a)(Object(d.a)(a));(s=t,fetch(x,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.json()})).then(function(e){setTimeout(function(){n.setState({sendingMessage:!1,sentMessage:!0}),z().then(function(e){n.setState({messages:e})}).catch(function(e){n.setState({error:"Canot load data from server!"})})},1e3)}).catch(function(e){setTimeout(function(){n.setState({error:"Canot add data to server!",sendingMessage:!1,sentMessage:!1})},1e3)})}var s},a.handleOnChange=function(e){a.setState({userMeassage:Object(c.a)({},a.state.userMeassage,Object(i.a)({},e.target.name,e.target.value))})},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;z().then(function(t){e.setState({messages:t})}).catch(function(t){return e.setState({error:"Canot load data from server!"})}),new Promise(function(e){navigator.geolocation.getCurrentPosition(function(t){e({lat:t.coords.latitude,lng:t.coords.longitude})},function(t){e(fetch("https://ipapi.co/json").then(function(e){return e.json()}).then(function(e){return{lat:e.latitude,lng:e.longitude}}))})}).then(function(t){e.setState({location:t,zoom:15,haveUserLocation:!0})});var t=this.mapRef.current;null!==t&&setTimeout(function(){t.leafletElement.invalidateSize()},400)}},{key:"render",value:function(){var e=this.state.location,t=this.state.sentMessage?"":s.a.createElement(f.a,{position:[e.lat,e.lng],icon:W}),a=this.state.messages.length?this.state.messages.map(function(e){return s.a.createElement(f.a,{key:e._id,position:[e.latitude,e.longitude],icon:q},s.a.createElement(p.a,null,s.a.createElement("p",null,s.a.createElement("em",null,e.name),": ",e.message),e.otherMessages?e.otherMessages.map(function(e,t){return s.a.createElement("p",{key:"item"+t},s.a.createElement("em",null,e.name),": ",e.message)}):""))}):"";return s.a.createElement("div",{className:"map"},s.a.createElement(v.a,{center:[e.lat,e.lng],zoom:this.state.zoom,ref:this.mapRef,className:"map"},s.a.createElement(M.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> Chat location by Iconika from the Noun Project',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t,a),s.a.createElement(J,{sendingMessage:this.state.sendingMessage,sentMessage:this.state.sentMessage,haveUserLocation:this.state.haveUserLocation,error:this.state.error,handleSubmit:this.handleSubmit,handleOnChange:this.handleOnChange,formIsNotValid:!this.formIsValid()}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},42:function(e,t,a){e.exports=a.p+"static/media/chat_location_shadow.5621c14c.svg"}},[[127,1,2]]]);
//# sourceMappingURL=main.e7283018.chunk.js.map